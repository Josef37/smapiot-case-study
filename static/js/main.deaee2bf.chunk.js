(this.webpackJsonpsmapiot=this.webpackJsonpsmapiot||[]).push([[0],{113:function(e,t,n){"use strict";n.r(t);var r=n(15),c=n(2),a=(n(0),n(13)),i=n(199),o=n(204),s=n(200),u=n(201),d=n(202),l=n(48),j=n(74),b=(n(197),function(e){var t=e.center,n=e.zoom,r=Object(d.a)();return r.setView(t,null!==n&&void 0!==n?n:r.getZoom()),null}),h={dragging:!1,touchZoom:!1,doubleClickZoom:!1,scrollWheelZoom:!1,boxZoom:!1,keyboard:!1,tap:!1};t.default=function(e){var t=e.machines,n=e.mapContainerProps,d=void 0===n?{}:n,O=e.disabled,m=t.map((function(e){return[e.longitude,e.latitude]})),f=Object(a.g)();return Object(c.jsxs)(i.a,Object(r.a)(Object(r.a)(Object(r.a)({zoomSnap:.25,bounds:m},O&&h),d),{},{children:[1===t.length&&Object(c.jsx)(b,{center:m[0],zoom:18}),Object(c.jsx)(o.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',maxZoom:22,maxNativeZoom:19,url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t.map((function(e){return Object(c.jsx)(s.a,{icon:Object(j.a)(e.machine_type),position:[e.longitude,e.latitude],eventHandlers:{click:function(){return f.push("/machines/".concat(e.id))}},interactive:!O,children:Object(c.jsx)(u.a,{children:Object(c.jsx)(l.a,{style:{fontSize:"1.4rem"},children:e.name})})},e.id)}))]}))}},198:function(e,t,n){"use strict";n.r(t);var r=n(2),c=n(0),a=n.n(c),i=n(10),o=n.n(i),s=n(27),u=n(18),d=n(254),l=n(106),j=n(20),b=n(29),h=n(85),O=n(107),m=n.n(O),f=n(108),p={},v=function(e,t){var n;p[e]=(null!==(n=p[e])&&void 0!==n?n:[]).concat(t)},x=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];p[e].forEach((function(e){return e.apply(void 0,n)}))}},g=new f.Socket("wss://machinestream.herokuapp.com/api/v1/events/websocket?vsn=2.0.0");g.connect();var y=g.channel("events");y.join().receive("error",x("ERROR")).receive("timeout",x("ERROR")),y.onError(x("ERROR")),y.on("new",x("MESSAGE"));var S,w=n(47),k=n(35),C=n.n(k),E=n(53),z=n(15),R=n(67),N=n(109),M=n.n(N).a.create({baseURL:"https://machinestream.herokuapp.com/api/v1/"}),_=function(){var e=Object(E.a)(C.a.mark((function e(){var t,n,r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.get("/machines");case 2:if(n=e.sent,r=null===(t=n.data)||void 0===t?void 0:t.data){e.next=6;break}throw new Error("No machines received");case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(E.a)(C.a.mark((function e(t){var n,r,c;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.get("/machines/".concat(t));case 2:if(r=e.sent,c=null===(n=r.data)||void 0===n?void 0:n.data){e.next=6;break}throw new Error("No machine details received");case 6:return e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=n(68),I=n.n(T),Z=n(239),D=n(240),L=Object(b.c)({sortComparer:function(e,t){var n;return null===e||void 0===e||null===(n=e.name)||void 0===n?void 0:n.localeCompare(null===t||void 0===t?void 0:t.name)}}),W=Object(b.c)({selectId:function(e){return"".concat(e.timestamp,",").concat(e.machine_id,",").concat(e.status)},sortComparer:function(e,t){return Object(Z.a)(Object(D.a)(e.timestamp),Object(D.a)(t.timestamp))}}),U={machines:L.getInitialState(),events:L.getInitialState(),isLoading:!1,errors:[]},P=function(e){return e.map((function(t,n){return Object(z.a)({name:"Machine ".concat((e.length-n).toString().padStart(Math.log10(e.length)+1,"0"))},t)}))},B=Object(b.b)("machines/load",function(){var e=Object(E.a)(C.a.mark((function e(t,n){var r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.getState,e.next=3,_();case 3:return r=e.sent,e.abrupt("return",P(r));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),F=Object(b.b)("machines/details",function(){var e=Object(E.a)(C.a.mark((function e(t){var n;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(t);case 2:return(n=e.sent).events=n.events.map((function(e){return Object(z.a)({machine_id:n.id},e)})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),G=Object(b.d)({name:"machines",initialState:U,reducers:{socketError:function(e){e.errors.push("Websocket error")},addEvent:function(e,t){var n=t.payload;W.addOne(e.events,n),L.updateOne(e.machines,{id:n.machine_id,changes:{status:n.status}})}},extraReducers:(S={},Object(w.a)(S,B.pending,(function(e,t){e.isLoading=!0})),Object(w.a)(S,B.fulfilled,(function(e,t){var n=t.payload;e.isLoading=!1,L.upsertMany(e.machines,n)})),Object(w.a)(S,B.rejected,(function(e,t){var n=t.error;e.isLoading=!1,e.errors.push(n.message)})),Object(w.a)(S,F.fulfilled,(function(e,t){var n=t.payload;W.upsertMany(e.events,n.events),delete n.events,L.upsertOne(e.machines,n)})),S)}),J=W.getSelectors((function(e){return e.machines.events})).selectAll,H=L.getSelectors((function(e){return e.machines.machines})),V=H.selectAll,X=H.selectById,q=Object(R.a)(J,(function(e){return I()((function(t){return e.filter((function(e){return e.machine_id===t}))}))})),K=G.actions,Q=K.socketError,Y=K.addEvent,$=G.reducer,ee=n(259),te=Object(b.c)({sortComparer:function(e,t){return Object(Z.a)(Object(D.a)(e.timestamp),Object(D.a)(t.timestamp))}}),ne=te.getInitialState(),re=Object(b.d)({name:"notes",initialState:ne,reducers:{addNote:{reducer:te.addOne,prepare:function(e){return{payload:Object(z.a)({id:Object(ee.a)(),timestamp:(new Date).toISOString()},e)}}}}}),ce=te.getSelectors((function(e){return e.notes})).selectAll,ae=Object(R.a)(ce,(function(e){return I()((function(t){return e.filter((function(e){return e.machine_id===t}))}))})),ie=re.actions.addNote,oe=re.reducer,se=Object(j.c)({machines:$,notes:oe}),ue={key:"root",storage:m.a,whitelist:["notes"]},de=Object(h.a)(ue,se),le=Object(b.a)({reducer:de}),je=Object(h.b)(le);v("ERROR",(function(){return le.dispatch(Q())})),v("MESSAGE",(function(e){return le.dispatch(Y(e))}));var be=n(13),he=n(263),Oe=Object(he.a)("nav")({display:"flex",gap:20,alignItems:"center",paddingLeft:20,borderBottom:"2px solid"}),me=Object(he.a)(s.b)({textDecoration:"none",fontSize:"1.6em"}),fe=function(){return Object(r.jsxs)(Oe,{children:[Object(r.jsx)(me,{to:"/machines",children:"Machines"}),Object(r.jsx)(me,{to:"/events",children:"Events"})]})},pe=n(246),ve=n(48),xe=n(33),ge=function(e){var t=Object(c.useReducer)((function(e){return e+1}),0),n=Object(xe.a)(t,2)[1];Object(c.useEffect)((function(){var t=setTimeout(n,e);return function(){return clearTimeout(t)}}))},ye=n(260),Se=n(245),we=n(243),ke=function(e){var t=e.event,n=t.machine_id,c=t.machineName,a=t.timestamp,i=t.status,o=Object(ye.a)(Object(D.a)(a),{addSuffix:!0});return Object(r.jsx)(Ce,{children:Object(r.jsxs)(we.a,{children:[Object(r.jsx)(Ee,{to:"/machines/".concat(n),children:Object(r.jsx)(ze,{variant:"h4",children:c})}),Object(r.jsx)(Re,{children:i}),Object(r.jsx)(Ne,{children:o})]})})},Ce=Object(he.a)(Se.a)({"--base-size":"1rem","&:first-child":{"--base-size":"2rem"}}),Ee=Object(he.a)(s.b)({textDecoration:"none",color:"inherit"}),ze=Object(he.a)(ve.a)({fontWeight:"bold",fontSize:"calc(2 * var(--base-size))"}),Re=Object(he.a)(ve.a)({fontSize:"calc(1.2 * var(--base-size))"}),Ne=Object(he.a)(ve.a)((function(e){return{color:e.theme.palette.grey[600],fontSize:"calc(0.8 * var(--base-size))"}})),Me=function(e){var t=e.events;return ge(3e4),t.length?Object(r.jsx)(pe.a,{children:t.map((function(e,t){return Object(r.jsx)(ke,{event:e},e.id||t)}))}):Object(r.jsx)(ve.a,{children:"No events to display"})},_e=function(){var e=Object(u.c)(J).slice(0,4),t=Object(u.c)((function(t){return e.map((function(e){return Object(z.a)({machineName:X(t,e.machine_id).name},e)}))}));return Object(r.jsx)(Me,{events:t})},Ae=function(){return Object(r.jsx)(_e,{})},Te=n(247),Ie=n(74),Ze=n(71),De=n.n(Ze),Le={running:"green",finished:"grey",errored:"red"},We=Object(he.a)("b")({fontSize:"1.2em",color:function(e){var t,n=e.status;return null!==(t=Le[n])&&void 0!==t?t:"inherit"}}),Ue=function(e){var t=e.status;return Object(r.jsxs)(ve.a,{children:["Status:"," ",Object(r.jsx)(We,{status:t,children:De()(t)})]})},Pe=Object(he.a)(s.c)({borderRight:"4px solid",borderRightColor:"transparent",textDecoration:"none",display:"block",color:"inherit","&.active":{borderRightColor:"green"}}),Be=function(e){var t=e.id,n=e.name,c=e.status,a=e.machine_type;return Object(r.jsx)(Pe,{to:"/machines/".concat(t),children:Object(r.jsxs)(Se.a,{children:[Object(r.jsxs)(we.a,{children:[Object(r.jsx)(ve.a,{variant:"h4",children:n}),Object(r.jsx)(Ue,{status:c})]}),Object(r.jsx)(Te.a,{style:{position:"relative",transform:"translateX(50%)"},ref:function(e){e&&!e.firstChild&&e.appendChild(Object(Ie.a)(a).createIcon())}})]})})},Fe=function(e){var t=e.machines;return Object(r.jsx)(pe.a,{children:t.map((function(e){return Object(r.jsx)(Be,Object(z.a)({},e),e.id)}))})},Ge=function(){var e=Object(u.c)(V);return Object(r.jsx)(Fe,{machines:e})},Je=n(264),He=n(262),Ve=n(248),Xe=n(261),qe=n(253),Ke=n(251),Qe=n(250),Ye=n(252),$e=n(255),et=function(e){var t=e.handleAdd,n=Object(c.useState)(!1),a=Object(xe.a)(n,2),i=a[0],o=a[1],s=Object(c.useState)(""),u=Object(xe.a)(s,2),d=u[0],l=u[1],j=function(){o(!1),l("")};return Object(r.jsxs)("div",{children:[Object(r.jsx)(Ve.a,{onClick:function(){return o(!0)},variant:"contained",color:"primary",style:{fontSize:"1.4em"},children:"Add Note"}),Object(r.jsxs)(Xe.a,{open:i,onClose:j,fullWidth:!0,children:[Object(r.jsx)(Qe.a,{id:"form-dialog-title",children:"Add a new note to this machine"}),Object(r.jsxs)(Ke.a,{children:[Object(r.jsx)(Ye.a,{children:"This note gets stored locally in your browser."}),Object(r.jsx)($e.a,{value:d,onChange:function(e){return l(e.target.value)},label:"Note content",autoFocus:!0,multiline:!0,rows:3,margin:"dense",fullWidth:!0,variant:"outlined"})]}),Object(r.jsxs)(qe.a,{children:[Object(r.jsx)(Ve.a,{onClick:j,color:"primary",children:"Cancel"}),Object(r.jsx)(Ve.a,{onClick:function(){j(),t(d)},color:"primary",children:"Add"})]})]})]})},tt=function(e){var t=e.machine_id,n=Object(u.b)();return Object(r.jsx)(et,{handleAdd:function(e){return n(ie({machine_id:t,content:e.trim()}))}})},nt=n(113),rt=n(249),ct=n(257),at=function(e){var t=e.data,n=e.getTimestamp,c=e.getContent,a=e.emptyMsg;return(null===t||void 0===t?void 0:t.length)?Object(r.jsx)(pe.a,{style:{paddingTop:0},children:t.map((function(e,t){return Object(r.jsx)(Se.a,{children:Object(r.jsxs)(we.a,{children:[Object(r.jsx)(ve.a,{style:{color:"darkgrey"},children:"["+Object(ct.a)(n(e),"yyyy-MM-dd")+"]"}),Object(r.jsx)(ve.a,{style:{fontSize:"1.2em",whiteSpace:"pre"},children:c(e)})]})},t)}))}):Object(r.jsx)(ve.a,{style:{padding:8},children:a||"No data"})},it=function(e){var t=e.main,n=e.aside;return Object(r.jsxs)(rt.a,{style:{display:"inline-block",padding:16,margin:10,minWidth:100},children:[Object(r.jsx)(ve.a,{style:{fontWeight:"bold",fontSize:32},children:t}),Object(r.jsx)(ve.a,{children:n})]})},ot=Object(he.a)("div")({padding:"30px 20px",position:"relative"}),st=Object(he.a)("div")({position:"absolute",top:0,right:0,display:"flex",flexDirection:"column",gap:20,alignItems:"center"}),ut=function(e){var t=e.machine,n=e.notes,c=e.events,a=t.name,i=t.status,o=t.machine_type,s=t.last_maintenance,u=t.floor,d=Object(Je.a)(Object(D.a)(s)),l=c.filter((function(e){return"errored"===e.status})).length,j=c.filter((function(e){return 30>Object(He.a)(Date.now(),Object(D.a)(e.timestamp))}));return Object(r.jsxs)(ot,{children:[Object(r.jsx)(ve.a,{variant:"h3",style:{fontWeight:"bold"},children:a}),Object(r.jsx)(Ue,{status:i}),Object(r.jsxs)(ve.a,{children:["Type: ",De()(o)]}),Object(r.jsxs)(ve.a,{children:["Floor: ",u]}),Object(r.jsx)(ve.a,{variant:"h4",style:{marginTop:20},children:"Details"}),Object(r.jsx)(it,{main:d,aside:"Uptime"}),Object(r.jsx)(it,{main:l,aside:"Errors"}),Object(r.jsx)(ve.a,{variant:"h4",style:{marginTop:20},children:"Notes"}),Object(r.jsx)(at,{data:n,getTimestamp:function(e){return Object(D.a)(e.timestamp)},getContent:function(e){return e.content},emptyMsg:"No notes stored..."}),Object(r.jsxs)(ve.a,{variant:"h4",style:{marginTop:20},children:["Events ",Object(r.jsxs)("span",{style:{fontSize:"0.6em"},children:["from the last ",30," days"]})]}),Object(r.jsx)(at,{data:j,getTimestamp:function(e){return Object(D.a)(e.timestamp)},getContent:function(e){return e.status},emptyMsg:"No events recorded..."}),Object(r.jsxs)(st,{children:[Object(r.jsx)(nt.default,{machines:[t],mapContainerProps:{style:{height:250,width:250},boundsOptions:{maxZoom:19},zoomControl:!1},disabled:!0}),Object(r.jsx)(tt,{machine_id:t.id})]})]})},dt=function(e){var t=e.id,n=Object(u.b)();Object(c.useEffect)((function(){n(F(t))}),[n,t]);var a=Object(u.c)((function(e){return X(e,t)})),i=Object(u.c)((function(e){return ae(e)(t)})),o=Object(u.c)((function(e){return q(e)(t)}));return a?Object(r.jsx)(ut,{machine:a,notes:i,events:o}):Object(r.jsx)(ve.a,{children:"Loading machine details"})},lt=a.a.lazy((function(){return Promise.resolve().then(n.bind(null,113))})),jt=function(){var e=Object(u.c)(V);return(null===e||void 0===e?void 0:e.length)?Object(r.jsx)(c.Suspense,{fallback:"Loading map",children:Object(r.jsx)(lt,{machines:e,mapContainerProps:{boundsOptions:{padding:[100,100],maxZoom:20}}})}):"Nothing to show"},bt=Object(he.a)("div")({display:"grid",gridTemplateColumns:"300px 1fr","& > *":{overflow:"hidden auto"}}),ht=function(){var e=Object(be.h)().path;return Object(r.jsxs)(bt,{children:[Object(r.jsx)(Ge,{}),Object(r.jsxs)(be.d,{children:[Object(r.jsx)(be.b,{path:"".concat(e,"/:id"),render:function(e){var t=e.match;return Object(r.jsx)(dt,{id:t.params.id})}}),Object(r.jsx)(be.b,{children:Object(r.jsx)(jt,{})})]})]})};var Ot=Object(he.a)("div")({width:"100vw",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column","& > :first-child":{flex:"0 0 50px"},"& > :last-child":{flex:"1 1 100px",overflow:"hidden"}}),mt=function(){var e=Object(u.b)();return Object(c.useEffect)((function(){e(B())}),[e]),Object(r.jsxs)(Ot,{children:[Object(r.jsx)(fe,{}),Object(r.jsxs)(be.d,{children:[Object(r.jsx)(be.b,{path:"/machines",children:Object(r.jsx)(ht,{})}),Object(r.jsx)(be.b,{path:"/events",children:Object(r.jsx)(Ae,{})}),Object(r.jsx)(be.b,{children:Object(r.jsx)(be.a,{to:"/machines"})})]})]})};o.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(u.a,{store:le,children:Object(r.jsx)(l.a,{persistor:je,children:Object(r.jsxs)(s.a,{children:[Object(r.jsx)(d.a,{}),Object(r.jsx)(mt,{})]})})})}),document.getElementById("root"))},74:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var r=n(15),c=n(31),a=n.n(c),i=n.p+"static/media/ruler.4f91741f.svg",o=n.p+"static/media/microscope.82c978f5.svg",s=n.p+"static/media/map-marker.d9fe5579.svg",u={iconSize:[32,32],tooltipAnchor:[16,0]},d=function(e){return a.a.icon(Object(r.a)(Object(r.a)({},u),e))},l=d({iconUrl:i}),j=d({iconUrl:o}),b=d({iconUrl:s}),h={microscope:j,measurement:l},O=function(e){var t;return null!==(t=h[e])&&void 0!==t?t:b}}},[[198,1,2]]]);
//# sourceMappingURL=main.deaee2bf.chunk.js.map