(this.webpackJsonpsmapiot=this.webpackJsonpsmapiot||[]).push([[0],{113:function(e,t,n){"use strict";n.r(t);var r=n(15),c=n(2),a=(n(0),n(13)),i=n(199),o=n(204),s=n(200),u=n(201),d=n(202),l=n(74),j=(n(197),function(e){var t=e.center,n=e.zoom,r=Object(d.a)();return r.setView(t,null!==n&&void 0!==n?n:r.getZoom()),null}),b={dragging:!1,touchZoom:!1,doubleClickZoom:!1,scrollWheelZoom:!1,boxZoom:!1,keyboard:!1,tap:!1};t.default=function(e){var t=e.machines,n=e.mapContainerProps,d=void 0===n?{}:n,h=e.disabled,O=t.map((function(e){return[e.longitude,e.latitude]})),m=Object(a.g)();return Object(c.jsxs)(i.a,Object(r.a)(Object(r.a)(Object(r.a)({zoomSnap:.25,bounds:O},h&&b),d),{},{children:[1===t.length&&Object(c.jsx)(j,{center:O[0],zoom:18}),Object(c.jsx)(o.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',maxZoom:22,maxNativeZoom:19,url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t.map((function(e){return Object(c.jsx)(s.a,{icon:Object(l.a)(e.machine_type),position:[e.longitude,e.latitude],eventHandlers:{click:function(){return m.push("/machines/".concat(e.id))}},interactive:!h,children:Object(c.jsx)(u.a,{children:e.name})},e.id)}))]}))}},198:function(e,t,n){"use strict";n.r(t);var r=n(2),c=n(0),a=n.n(c),i=n(10),o=n.n(i),s=n(27),u=n(18),d=n(254),l=n(106),j=n(20),b=n(28),h=n(85),O=n(107),m=n.n(O),f=n(108),p={},v=function(e,t){var n;p[e]=(null!==(n=p[e])&&void 0!==n?n:[]).concat(t)},x=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];p[e].forEach((function(e){return e.apply(void 0,n)}))}},g=new f.Socket("wss://machinestream.herokuapp.com/api/v1/events/websocket?vsn=2.0.0");g.connect();var y=g.channel("events");y.join().receive("error",x("ERROR")).receive("timeout",x("ERROR")),y.onError(x("ERROR")),y.on("new",x("MESSAGE"));var S,w=n(47),k=n(33),C=n.n(k),E=n(15),z=n(52),R=n(67),N=n(109),M=n.n(N).a.create({baseURL:"https://machinestream.herokuapp.com/api/v1/"}),_=function(){var e=Object(z.a)(C.a.mark((function e(){var t,n,r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.get("/machines");case 2:if(n=e.sent,r=null===(t=n.data)||void 0===t?void 0:t.data){e.next=6;break}throw new Error("No machines received");case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(z.a)(C.a.mark((function e(t){var n,r,c;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.get("/machines/".concat(t));case 2:if(r=e.sent,c=null===(n=r.data)||void 0===n?void 0:n.data){e.next=6;break}throw new Error("No machine details received");case 6:return e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=n(68),I=n.n(T),Z=n(239),L=n(240),W=Object(b.c)({sortComparer:function(e,t){var n;return null===e||void 0===e||null===(n=e.name)||void 0===n?void 0:n.localeCompare(null===t||void 0===t?void 0:t.name)}}),D=Object(b.c)({selectId:function(e){return"".concat(e.timestamp,",").concat(e.machine_id,",").concat(e.status)},sortComparer:function(e,t){return Object(Z.a)(Object(L.a)(e.timestamp),Object(L.a)(t.timestamp))}}),U={machines:W.getInitialState(),events:W.getInitialState(),isLoading:!1,errors:[]},P=Object(b.b)("machines/load",function(){var e=Object(z.a)(C.a.mark((function e(t,n){var r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.getState,e.next=3,_();case 3:return r=e.sent,e.abrupt("return",r.map((function(e,t){return Object(E.a)({name:"Machine ".concat((r.length-t).toString().padStart(Math.log10(r.length)+1,"0"))},e)})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),B=Object(b.b)("machines/details",function(){var e=Object(z.a)(C.a.mark((function e(t){var n;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(t);case 2:return(n=e.sent).events=n.events.map((function(e){return Object(E.a)({machine_id:n.id},e)})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),F=Object(b.d)({name:"machines",initialState:U,reducers:{socketError:function(e){e.errors.push("Websocket error")},addEvent:function(e,t){var n=t.payload;D.addOne(e.events,n),W.updateOne(e.machines,{id:n.machine_id,changes:{status:n.status}})}},extraReducers:(S={},Object(w.a)(S,P.pending,(function(e,t){e.isLoading=!0})),Object(w.a)(S,P.fulfilled,(function(e,t){var n=t.payload;e.isLoading=!1,W.upsertMany(e.machines,n)})),Object(w.a)(S,P.rejected,(function(e,t){var n=t.error;e.isLoading=!1,e.errors.push(n.message)})),Object(w.a)(S,B.fulfilled,(function(e,t){var n=t.payload;D.upsertMany(e.events,n.events),delete n.events,W.upsertOne(e.machines,n)})),S)}),G=D.getSelectors((function(e){return e.machines.events})).selectAll,J=W.getSelectors((function(e){return e.machines.machines})),H=J.selectAll,V=J.selectById,X=Object(R.a)(G,(function(e){return I()((function(t){return e.filter((function(e){return e.machine_id===t}))}))})),q=F.actions,K=q.socketError,Q=q.addEvent,Y=F.reducer,$=n(259),ee=Object(b.c)({sortComparer:function(e,t){return Object(Z.a)(Object(L.a)(e.timestamp),Object(L.a)(t.timestamp))}}),te=ee.getInitialState(),ne=Object(b.d)({name:"notes",initialState:te,reducers:{addNote:{reducer:ee.addOne,prepare:function(e){return{payload:Object(E.a)({id:Object($.a)(),timestamp:(new Date).toISOString()},e)}}}}}),re=ee.getSelectors((function(e){return e.notes})).selectAll,ce=Object(R.a)(re,(function(e){return I()((function(t){return e.filter((function(e){return e.machine_id===t}))}))})),ae=ne.actions.addNote,ie=ne.reducer,oe=Object(j.c)({machines:Y,notes:ie}),se={key:"root",storage:m.a,whitelist:["notes"]},ue=Object(h.a)(se,oe),de=Object(b.a)({reducer:ue}),le=Object(h.b)(de);v("ERROR",(function(){return de.dispatch(K())})),v("MESSAGE",(function(e){return de.dispatch(Q(e))}));var je=n(13),be=n(262),he=Object(be.a)("nav")({display:"flex",gap:20,alignItems:"center",paddingLeft:20,borderBottom:"2px solid"}),Oe=Object(be.a)(s.b)({textDecoration:"none",fontSize:"1.6em"}),me=function(){return Object(r.jsxs)(he,{children:[Object(r.jsx)(Oe,{to:"/machines",children:"Machines"}),Object(r.jsx)(Oe,{to:"/events",children:"Events"})]})},fe=n(246),pe=n(56),ve=n(31),xe=function(e){var t=Object(c.useReducer)((function(e){return e+1}),0),n=Object(ve.a)(t,2)[1];Object(c.useEffect)((function(){var t=setTimeout(n,e);return function(){return clearTimeout(t)}}))},ge=n(260),ye=n(245),Se=n(243),we=function(e){var t=e.event,n=t.machine_id,c=t.machineName,a=t.timestamp,i=t.status,o=Object(ge.a)(Object(L.a)(a),{addSuffix:!0});return Object(r.jsx)(ke,{children:Object(r.jsxs)(Se.a,{children:[Object(r.jsx)(Ce,{to:"/machines/".concat(n),children:Object(r.jsx)(Ee,{variant:"h4",children:c})}),Object(r.jsx)(ze,{children:i}),Object(r.jsx)(Re,{children:o})]})})},ke=Object(be.a)(ye.a)({"--base-size":"1rem","&:first-child":{"--base-size":"2rem"}}),Ce=Object(be.a)(s.b)({textDecoration:"none",color:"inherit"}),Ee=Object(be.a)(pe.a)({fontWeight:"bold",fontSize:"calc(2 * var(--base-size))"}),ze=Object(be.a)(pe.a)({fontSize:"calc(1.2 * var(--base-size))"}),Re=Object(be.a)(pe.a)((function(e){return{color:e.theme.palette.grey[600],fontSize:"calc(0.8 * var(--base-size))"}})),Ne=function(e){var t=e.events;return xe(3e4),t.length?Object(r.jsx)(fe.a,{children:t.map((function(e,t){return Object(r.jsx)(we,{event:e},e.id||t)}))}):Object(r.jsx)(pe.a,{children:"No events to display"})},Me=function(){var e=Object(u.c)(G).slice(0,4),t=Object(u.c)((function(t){return e.map((function(e){return Object(E.a)({machineName:V(t,e.machine_id).name},e)}))}));return Object(r.jsx)(Ne,{events:t})},_e=function(){return Object(r.jsx)(Me,{})},Ae=n(247),Te=n(74),Ie=n(71),Ze=n.n(Ie),Le={running:"green",finished:"grey",errored:"red"},We=Object(be.a)("b")({fontSize:"1.2em",color:function(e){var t,n=e.status;return null!==(t=Le[n])&&void 0!==t?t:"inherit"}}),De=function(e){var t=e.status;return Object(r.jsxs)(pe.a,{children:["Status:"," ",Object(r.jsx)(We,{status:t,children:Ze()(t)})]})},Ue=Object(be.a)(s.c)({borderRight:"4px solid",borderRightColor:"transparent",textDecoration:"none",display:"block",color:"inherit","&.active":{borderRightColor:"green"}}),Pe=function(e){var t=e.id,n=e.name,c=e.status,a=e.machine_type;return Object(r.jsx)(Ue,{to:"/machines/".concat(t),children:Object(r.jsxs)(ye.a,{children:[Object(r.jsxs)(Se.a,{children:[Object(r.jsx)(pe.a,{variant:"h4",children:n}),Object(r.jsx)(De,{status:c})]}),Object(r.jsx)(Ae.a,{style:{position:"relative",transform:"translateX(50%)"},ref:function(e){e&&!e.firstChild&&e.appendChild(Object(Te.a)(a).createIcon())}})]})})},Be=function(e){var t=e.machines;return Object(r.jsx)(fe.a,{children:t.map((function(e){return Object(r.jsx)(Pe,Object(E.a)({},e),e.id)}))})},Fe=function(){var e=Object(u.c)(H);return Object(r.jsx)(Be,{machines:e})},Ge=n(263),Je=n(248),He=n(261),Ve=n(253),Xe=n(251),qe=n(250),Ke=n(252),Qe=n(255),Ye=function(e){var t=e.handleAdd,n=Object(c.useState)(!1),a=Object(ve.a)(n,2),i=a[0],o=a[1],s=Object(c.useState)(""),u=Object(ve.a)(s,2),d=u[0],l=u[1],j=function(){o(!1),l("")};return Object(r.jsxs)("div",{children:[Object(r.jsx)(Je.a,{onClick:function(){return o(!0)},variant:"contained",color:"primary",style:{fontSize:"1.4em"},children:"Add Note"}),Object(r.jsxs)(He.a,{open:i,onClose:j,fullWidth:!0,children:[Object(r.jsx)(qe.a,{id:"form-dialog-title",children:"Add a new note to this machine"}),Object(r.jsxs)(Xe.a,{children:[Object(r.jsx)(Ke.a,{children:"This note gets stored locally in your browser."}),Object(r.jsx)(Qe.a,{value:d,onChange:function(e){return l(e.target.value)},label:"Note content",autoFocus:!0,multiline:!0,rows:3,margin:"dense",fullWidth:!0,variant:"outlined"})]}),Object(r.jsxs)(Ve.a,{children:[Object(r.jsx)(Je.a,{onClick:j,color:"primary",children:"Cancel"}),Object(r.jsx)(Je.a,{onClick:function(){j(),t(d)},color:"primary",children:"Add"})]})]})]})},$e=function(e){var t=e.machine_id,n=Object(u.b)();return Object(r.jsx)(Ye,{handleAdd:function(e){return n(ae({machine_id:t,content:e.trim()}))}})},et=n(113),tt=n(249),nt=n(257),rt=function(e){var t=e.data,n=e.getTimestamp,c=e.getContent,a=e.emptyMsg;return(null===t||void 0===t?void 0:t.length)?Object(r.jsx)(fe.a,{style:{paddingTop:0},children:t.map((function(e,t){return Object(r.jsx)(ye.a,{children:Object(r.jsxs)(Se.a,{children:[Object(r.jsx)(pe.a,{style:{color:"darkgrey"},children:"["+Object(nt.a)(n(e),"yyyy-MM-dd")+"]"}),Object(r.jsx)(pe.a,{style:{fontSize:"1.2em",whiteSpace:"pre"},children:c(e)})]})},t)}))}):Object(r.jsx)(pe.a,{style:{padding:8},children:a||"No data"})},ct=function(e){var t=e.main,n=e.aside;return Object(r.jsxs)(tt.a,{style:{display:"inline-block",padding:16,margin:10,minWidth:100},children:[Object(r.jsx)(pe.a,{style:{fontWeight:"bold",fontSize:32},children:t}),Object(r.jsx)(pe.a,{children:n})]})},at=Object(be.a)("div")({padding:"30px 20px",position:"relative"}),it=Object(be.a)("div")({position:"absolute",top:0,right:0,display:"flex",flexDirection:"column",gap:20,alignItems:"center"}),ot=function(e){var t=e.machine,n=e.notes,c=e.events,a=t.name,i=t.status,o=t.machine_type,s=t.last_maintenance,u=t.floor,d=Object(Ge.a)(Object(L.a)(s)),l=c.filter((function(e){return"errored"===e.status})).length;return Object(r.jsxs)(at,{children:[Object(r.jsx)(pe.a,{variant:"h3",style:{fontWeight:"bold"},children:a}),Object(r.jsx)(De,{status:i}),Object(r.jsxs)(pe.a,{children:["Type: ",Ze()(o)]}),Object(r.jsxs)(pe.a,{children:["Floor: ",u]}),Object(r.jsx)(pe.a,{variant:"h4",style:{marginTop:20},children:"Details"}),Object(r.jsx)(ct,{main:d,aside:"Uptime"}),Object(r.jsx)(ct,{main:l,aside:"Errors"}),Object(r.jsx)(pe.a,{variant:"h4",style:{marginTop:20},children:"Notes"}),Object(r.jsx)(rt,{data:n,getTimestamp:function(e){return Object(L.a)(e.timestamp)},getContent:function(e){return e.content},emptyMsg:"No notes stored..."}),Object(r.jsx)(pe.a,{variant:"h4",style:{marginTop:20},children:"Events"}),Object(r.jsx)(rt,{data:c,getTimestamp:function(e){return Object(L.a)(e.timestamp)},getContent:function(e){return e.status},emptyMsg:"No events recorded..."}),Object(r.jsxs)(it,{children:[Object(r.jsx)(et.default,{machines:[t],mapContainerProps:{style:{height:250,width:250},boundsOptions:{maxZoom:19},zoomControl:!1},disabled:!0}),Object(r.jsx)($e,{machine_id:t.id})]})]})},st=function(e){var t=e.id,n=Object(u.b)();Object(c.useEffect)((function(){n(B(t))}),[n,t]);var a=Object(u.c)((function(e){return V(e,t)})),i=Object(u.c)((function(e){return ce(e)(t)})),o=Object(u.c)((function(e){return X(e)(t)}));return a?Object(r.jsx)(ot,{machine:a,notes:i,events:o}):Object(r.jsx)(pe.a,{children:"Loading machine details"})},ut=a.a.lazy((function(){return Promise.resolve().then(n.bind(null,113))})),dt=function(){var e=Object(u.c)(H);return(null===e||void 0===e?void 0:e.length)?Object(r.jsx)(c.Suspense,{fallback:"Loading map",children:Object(r.jsx)(ut,{machines:e,mapContainerProps:{boundsOptions:{padding:[100,100],maxZoom:20}}})}):"Nothing to show"},lt=Object(be.a)("div")({display:"grid",gridTemplateColumns:"300px 1fr","& > *":{overflow:"hidden auto"}}),jt=function(){var e=Object(je.h)().path;return Object(r.jsxs)(lt,{children:[Object(r.jsx)(Fe,{}),Object(r.jsxs)(je.d,{children:[Object(r.jsx)(je.b,{path:"".concat(e,"/:id"),render:function(e){var t=e.match;return Object(r.jsx)(st,{id:t.params.id})}}),Object(r.jsx)(je.b,{children:Object(r.jsx)(dt,{})})]})]})};var bt=Object(be.a)("div")({width:"100vw",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column","& > :first-child":{flex:"0 0 50px"},"& > :last-child":{flex:"1 1 100px",overflow:"hidden"}}),ht=function(){var e=Object(u.b)();return Object(c.useEffect)((function(){e(P())}),[e]),Object(r.jsxs)(bt,{children:[Object(r.jsx)(me,{}),Object(r.jsxs)(je.d,{children:[Object(r.jsx)(je.b,{path:"/machines",children:Object(r.jsx)(jt,{})}),Object(r.jsx)(je.b,{path:"/events",children:Object(r.jsx)(_e,{})}),Object(r.jsx)(je.b,{children:Object(r.jsx)(je.a,{to:"/machines"})})]})]})};o.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(u.a,{store:de,children:Object(r.jsx)(l.a,{persistor:le,children:Object(r.jsxs)(s.a,{children:[Object(r.jsx)(d.a,{}),Object(r.jsx)(ht,{})]})})})}),document.getElementById("root"))},74:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var r=n(15),c=n(29),a=n.n(c),i=n.p+"static/media/ruler.4f91741f.svg",o=n.p+"static/media/microscope.82c978f5.svg",s=n.p+"static/media/map-marker.d9fe5579.svg",u={iconSize:[32,32],tooltipAnchor:[16,0]},d=function(e){return a.a.icon(Object(r.a)(Object(r.a)({},u),e))},l=d({iconUrl:i}),j=d({iconUrl:o}),b=d({iconUrl:s}),h={microscope:j,measurement:l},O=function(e){var t;return null!==(t=h[e])&&void 0!==t?t:b}}},[[198,1,2]]]);
//# sourceMappingURL=main.34f71a5e.chunk.js.map